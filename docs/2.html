<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Didah Morse Code PDA/Appliance: Instructions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Didah Morse Code PDA/Appliance
   &#160;<span id="projectnumber">1.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Instructions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>The Didah Voltage Monitor Appliance</h1>
<p>The Didah Voltage Monitor Appliance is intended to periodically report battery voltage for an autonomous amatuer radio repeater station. It transmits a Morse code message on the TX output at a 3.3V signal level. The appliance is intended to monitor and draw power from a 12V rechargable battery.</p>
<p>The CPU module in Didah is a Teensy3 running at 24 MHz. There is a voltage divider and voltage regulator designed support voltages up to 20V. The lowest voltage that can be monitored is approximately 2.7V.</p>
<h2>Setting Operational Parameters via Morse Code</h2>
<p>Two touch sensor rivets on the case labeled <code></code>(.) and <code></code>(-) operate as an Iambic keyer. Input is entered in International Morse Code. The dit duration is initially 100 milliseconds, although this can be adjusted.</p>
<p>Audio output is generated three ways:</p><ul>
<li>An internal speaker</li>
<li>A stereo headphone jack wired to the right channel only intended for demonstrations or noisy environments</li>
<li>The TX output terminal to be wired to the repeat transmitter</li>
<li>The TE output is an open collector that activates 120 ms prior to transmission.</li>
</ul>
<p>A very abbreviated menu can be requested by entering an M (<code>--</code>). Output can be aborted by holding a key for approximately 100 milliseconds, but this action may be interpreted as a command.</p>
<p>Commands are keyed in three ways:</p><ul>
<li>Simple commands consist of a single Morse code token, such as M to request the menu of commands.</li>
<li>Commands that require arguments are entered by first entering the arguments and then entering the command. This makes it possible to review and correct the arguments before committing to the action.</li>
<li>Commands that require freeform text initiate a text copying mode terminated by the <span class="prosign">AR</span> prosign or by a timeout.</li>
</ul>
<h2>Setting Operational Parameters via Serial Console</h2>
<p>The USB Micro-B receptacle can be used to connect the appliance to a computer. The appliance appears as a serial device (like a modem or remote terminal). A terminal emulator such as Putty or the Linux commands <code>cu</code> or <code>screen</code> in a command shell can be used for command-line interface.</p>
<p>The serial parameters are:</p>
<table class="doxtable">
<tr>
<th>Setting </th><th>Value  </th></tr>
<tr>
<td>Speed </td><td>9600 bps </td></tr>
<tr>
<td>Parity </td><td>None </td></tr>
<tr>
<td>Data </td><td>8 bits </td></tr>
<tr>
<td>Stop bits </td><td>None </td></tr>
<tr>
<td>Flow control </td><td>None </td></tr>
</table>
<p>For Macintosh OS X, in a terminal window the following command can be used to initiate a command-line dialog:</p>
<p><code>sudo cu -l /dev/tty.usbmodem* -s 9600 --nostop --parity=none</code></p>
<p>As of OS X 10.8.4, the cu program does not successfully restore the serial connection when waking from sleep mode. It may be necessary to kill the cu session. A cu session can usually be terminated by typing</p>
<p><code>~.&lt;enter&gt;</code></p>
<p>twice. Note that <code>&lt;enter&gt;</code> represents the Enter or Return key.</p>
<p>To use screen instead of cu:</p>
<p><code>sudo screen /dev/tty.usbmodem* 9600</code></p>
<p>For Linux, in a terminal window the following command can be used to initiate a command-line dialog:</p>
<p><code>sudo cu -l /dev/tty.usbserial-* -s 9600</code></p>
<p>The name of the serial device may vary from session to session. If more than one serial device is connected, the wildcard would need to be changed to something more specific. A little quality time with the for cu or screen might yield a way to configure Didah by inserting a file in the serial stream or log serial output to a file.</p>
<h2>Settings</h2>
<p>In the default configuration, input voltage is transmitted every 10 minutes in Morse Code as follows:</p>
<p><code>BAT 4801 MV ? 4801 MV</code></p>
<p>The message content, repetition interval, transmission rate, pitch (side tone), and alarm level can all be configured. The configuration can be saved to persistent storage.</p>
<h2>Command-line Interaction</h2>
<table class="doxtable">
<tr>
<th>Command </th><th>Description  </th></tr>
<tr>
<td>? </td><td>Help </td></tr>
<tr>
<td>A </td><td>Set low-voltage alarm threshold in millivolts [2700-16000] </td></tr>
<tr>
<td>B </td><td>Set high-voltage alarm threshold in millivolts [2700-16000] </td></tr>
<tr>
<td>D </td><td>Set dit duration in milliseconds [20-200] </td></tr>
<tr>
<td>F </td><td>Set normal announcement format </td></tr>
<tr>
<td>G </td><td>Set low-voltage announcement format </td></tr>
<tr>
<td>H </td><td>Set high-voltage announcement format </td></tr>
<tr>
<td>I </td><td>Set normal announcement interval in seconds [20-86400] </td></tr>
<tr>
<td>J </td><td>Set alarm announcement interval in seconds [20-86400] </td></tr>
<tr>
<td>L </td><td>Print settings and log </td></tr>
<tr>
<td>O </td><td>Load settings from EEPROM </td></tr>
<tr>
<td>P </td><td>Set output frequency (pitch) in Hz [55-1760] </td></tr>
<tr>
<td>S </td><td>Save settings to EEPROM </td></tr>
<tr>
<td>T </td><td>Set the 24-hour time [0000-2359] </td></tr>
</table>
<h3>The Help Command</h3>
<p>The Help command (<code>?</code>) prints a banner, settings, and a brief list of commands.</p>
<h3>Setting the Low-voltage Alarm Threshold</h3>
<p>The Low-voltage Alarm Threshold command (<code>A</code>) prompts for a value in millivolts, ranging from 2700 to 16000 millivolts. When the input voltage falls below this threshold, alternate values are used for the announcement repetition format and interval. The red LED is lit continuously at a dim level. The default threshold is 2700 millivolts.  
<p><code>
&gt; <b>A</b></br>
Enter low-voltage threshold in mV [2700-16000]: <b>4000</b></br>
Low-voltage threshold: 4000 mV</br>
&gt;
</code></p>
</p>
<h3>Setting the Low-voltage Alarm Threshold</h3>
<p>The High-voltage Alarm Threshold command (<code>B</code>) prompts for a value in millivolts, ranging from 2700 to 16000 millivolts. When the input voltage rises above this threshold, alternate values are used for the announcement repetition format and interval. The red LED is lit continuously at a dim level. The default threshold is 16000 millivolts.</p>
<h3>Setting the Dit Duration</h3>
<p>The Dit Duration command (<code>D</code>) prompts for a value in milliseconds, ranging from 20 to 200. This sets the rate at which Morse Code is entered and transmitted. The default duration is 40 milliseconds.</p>
<h3>Setting the Normal Announcement Format</h3>
<p>The Normal Announcement Format command (<code>F</code>) prompts the user for a text template for periodic announcements when the voltage is at a nominal level.</p>
<p>The format template for announcements uses the following notation:</p>
<table class="doxtable">
<tr>
<th>Symbol </th><th>Interpretation  </th></tr>
<tr>
<td>A-Z </td><td>Literal character </td></tr>
<tr>
<td>0-9 </td><td>Literal number </td></tr>
<tr>
<td><em>space</em> </td><td>Pause for one dit unit </td></tr>
<tr>
<td><em>punctuation</em> </td><td>Literal punctuation: !"$&amp;'()+,-./:;=? </td></tr>
<tr>
<td><em>^ps^</em> </td><td>Prosign of up to seven dits and dahs. <br />
 For example prosign BK is transmitted <code>-</code>....-. </td></tr>
<tr>
<td>%V </td><td>Monitor voltage in millivolts </td></tr>
<tr>
<td>%F </td><td>Temperature in degrees Fahrenheit </td></tr>
<tr>
<td>%C </td><td>Temperature in degrees Celsius </td></tr>
<tr>
<td>%T </td><td>Time of day in four-digit 24-hour time: HHMM </td></tr>
<tr>
<td>%U </td><td>Uptime in four digits: HHMM </td></tr>
</table>
<p>The default announcement format is <code>BAT 4801 MV ? 4801 MV</code>.</p>
<h3>Setting the Low-Voltage Alarm Announcement Format</h3>
<p>The Low-Voltage Announcement Format command (<code>G</code>) prompts the user for a text template for periodic announcements when the voltage is below the nominal range. The template format is identical to the nominal announcement format above. The default alarm format is <code>BAT 4801 MV ? 4801 MV</code>.</p>
<h3>Setting the High-Voltage Alarm Announcement Format</h3>
<p>The High-Voltage Alarm Format command (<code>H</code>) prompts the user for a text template for periodic announcements when the voltage is above the nominal ramge. The template format is identical to the nominal announcement format above. The default alarm format is <code>BAT 16000 MV ? 16000 MV</code>.</p>
<h3>Setting the Normal Announcement Interval</h3>
<p>The Normal Announcement Interval command (<code>I</code>) prompts the user for a time interval in seconds ranging from 20 to 86,400 (24 hours). When the voltage is nominal, and the time in seconds is a multiple of this value, a nominal announcement is transmitted. The default announcement interval is 600 seconds (ten minutes).</p>
<h3>Setting the Alarm Announcement Interval</h3>
<p>The Alarm Announcement Interval command (<code>J</code>) prompts the user for a time interval in seconds ranging from 20 to 86,400 (24 hours). When the voltage is at or below the alarm threshold, and the time in seconds is a multiple of this value, an alarm announcement is transmitted. The default alarm interval is 30 seconds.</p>
<h3>The Log Command</h3>
<p>The Log command (<code>L</code>) causes the current readings and settings to be printed.</p>
<p>A typical log message is as follows: </p><div class="fragment"><div class="line">Didah Voltage Monitor</div><div class="line">=====================</div><div class="line">Version: 1.3</div><div class="line">Documentation: http:<span class="comment">//pictographer.com/didah</span></div><div class="line"></div><div class="line">Device to periodically announce input voltage in Morse code.</div><div class="line"></div><div class="line">Measurements</div><div class="line">--------</div><div class="line">Time: 1514</div><div class="line">Uptime: 315 minutes</div><div class="line">Measured voltage: 4939 mV (Nominal)</div><div class="line">Temperature: 25.87 C</div><div class="line"></div><div class="line">Settings</div><div class="line">--------</div><div class="line">Nominal announcement format: BAT %V MV ? %V MV</div><div class="line">Nominal announcement interval: 600 seconds</div><div class="line">Low-voltage alarm threshold: 2700 mV</div><div class="line">Low-voltage alarm announcement format: LOW V %V ? %V TEMP %C C</div><div class="line">High-voltage alarm threshold: 16000 mV</div><div class="line">High-voltage alarm announcement format: HIGH V %V ? %V TEMP %C C</div><div class="line">Alarm interval: 60 seconds</div><div class="line">Dit duration: 40 ms</div><div class="line">Output frequency: 900 Hz</div></div><!-- fragment --><h3>Loading Persistent Settings</h3>
<p>The Load Settings command (O) restores settings saved previously. <b>N.B</b>. This command takes effect immediately without confirmation. Any unsaved changes are overwritten.</p>
<p>In the event of a temporary power failure, settings revert to their default values; the settings saved by the user are not automatically restored.</p>
<h3>Setting the Output Frequency (Side Tone)</h3>
<p>The output frequency or side tone can be set using the (P) command. The frequency range is 55 to 1760 Hz. The default frequency is 750 Hz.</p>
<h3>Saving Settings</h3>
<p>The Save command (S) stores the current settings to EEPROM. These settings are preserved when there is no power to the appliance. <b>N.B</b>. This command takes effect immediately without confirmation. Any unsaved changes are overwritten.</p>
<h3>Setting the Time</h3>
<p>The Time command (T) prompts the user for the current 24-hour time [0000-2359]. The time in seconds is used to determine the timing of the announcements. <b>N.B</b>. The uptime stored in EEPROM does not get updated unless the time is set. This allows the user to see how long the appliance was up before a power failure.</p>
<h2>Morse Code Interaction</h2>
<p>The Morse Code interface is designed to provide a quick method for an experienced CW operator to adjust the settings of the voltage monitor appliance. As mentioned above, commands are keyed in three ways:</p><ul>
<li>Simple commands consist of a single Morse code token, such as M to request the menu of commands.</li>
<li>Commands that require arguments are entered after the arguments so that it is possible to review and correct the arguments before entering the command.</li>
<li>Commands that require freeform text initiate a text copying mode terminated by the <span class="prosign">AR</span> prosign or by a timeout.</li>
</ul>
<h3>The Menu Command</h3>
<p>The Menu Command (<code>--</code>) transmits an abbreviated list of commands: </p><div class="fragment"><div class="line">A  LOW V IN MV,</div><div class="line">B  HIGH V IN MV,</div><div class="line">C  CLEAR, </div><div class="line">D  DIT MS, </div><div class="line">F  MSG FMT, </div><div class="line">G  ALARM LOW FMT, </div><div class="line">H  ALARM HIGH FMT,</div><div class="line">I  RPT SECS, </div><div class="line">J  RPT ALARM SECS, </div><div class="line">L  LIST,</div><div class="line">M  MENU,</div><div class="line">O  LOAD,</div><div class="line">P  TONE HZ, </div><div class="line">S  SAVE,</div><div class="line">T  TIME, </div><div class="line">U  UPTIME. </div></div><!-- fragment --><h3>Setting the Low-voltage Alarm Threshold</h3>
<p>The <code>.-</code> (A) command expects a number ranging from 2700 to 16000 to have been entered and sets the low-voltage alarm threshold accordingly.</p>
<p>For example, to set the low-voltage alarm threshold to 5V,</p>
<p>User: <code>...../-----/-----/-----/.-</code> <br />
System: <code>-.-</code> <br />
 If the number is out of range, the system will transmit 8 dits followed by the word "RANGE".</p>
<h3>Setting the High-voltage Alarm Threshold</h3>
<p>The <code>-...</code> (B) command expects a number ranging from 2700 to 16000 to have been entered and sets the high-voltage alarm threshold accordingly.</p>
<p>For example, to set the high-voltage alarm threshold to 14V,</p>
<p>User: <code>.----/....-/-----/-----/-----/-...</code> <br />
System: <code>-.-</code> <br />
 If the number is out of range, the system will transmit 8 dits followed by the word "RANGE".</p>
<h3>Setting the Dit Duration</h3>
<p>The <code>-..</code> (D) command expects a number of milliseconds ranging from 20 to 200 to have been entered and sets the dit duration accordingly.</p>
<p>For example, to set the dit duration to 50ms,</p>
<p>User: <code>...../-----/.-</code> <br />
System: <code>-.-</code> <br />
 If the number is out of range, the system will transmit 8 dits followed by the word "RANGE".</p>
<h3>Setting the Normal Announcement Format</h3>
<p>The <code>..-.</code> (F) command causes the system to prompt for a format template. The system responds with <code>TX MSG END WITH</code> <span class="prosign">AR</span> <code>K</code>.</p>
<p>For example, here is how to make the system transmit the voltage followed by MV:</p>
<p>User: <code>.._.</code> <br />
System: <code>_ _.._ /__ ... __. /. _. _.. /.__ .. _ .... /._._. //_._</code> <br />
User: <code>..--../...-//--/...-/.-.-.</code> <br />
System: <code>-.-</code> <br />
 Or in text,</p>
<p>User: F<br />
System: TX MSG END WITH <span class="prosign">AR</span> OVER<br />
User: ?V MV <span class="prosign">AR</span><br />
System: OVER<br />
 <b>N.B</b>. To indicate a placeholder, key a question mark (<code>..--..</code>) followed immediately by one of V, F, C, T, or U. A question mark followed by a pause or any other token is transmitted literally.</p>
<p>The format template is used for generating periodic messages when the voltage level is nominal just prior to message generation. The default format is <code>BAT 4801 MV ? 4801 MV</code>.</p>
<h3>Setting the Alarm Low-Voltage Announcement Format</h3>
<p>The <code>--.</code> (G) command causes the system to prompt for a low-voltage alert format string. Refer to the F command above for details.</p>
<h3>Setting the Alarm High-Voltage Announcement Format</h3>
<p>The <code>....</code> (H) command causes the system to prompt for a high-voltage alert format string. Refer to the F command above for details.</p>
<h3>Setting the Normal Announcement Interval</h3>
<p>The <code>..</code> (I) command expects a number of seconds ranging from 20 to 86400 to have been entered and sets the nominal announcement interval accordingly. The interval is coordinated with the time of day. The default interval is 600 seconds (ten minutes).</p>
<h3>Setting the Alarm Announcement Interval</h3>
<p>The <code>.---</code> (J) command expects a number of seconds ranging from 20 to 86400 to have been entered and sets the alarm announcement interval accordingly. The interval is coordinated with the time of day. The default alarm interval is 30 seconds.</p>
<h3>The Log Command</h3>
<p>The <code>.-..</code> (L) command transmits a log of the current settings. For example,</p>
<div class="fragment"><div class="line">SETTINGS.</div><div class="line">MSG RPT SKED IS 600 SECONDS.</div><div class="line">MSG FORMAT IS  BAT ?V MV ? ?V MV . </div><div class="line">ALARM VOLTAGE IS 4000  MV. </div><div class="line">ALARM MSG RPT SKED IS 30 SECONDS. </div><div class="line">ALARM MSG FORMAT IS  BAT ?V MV ? ?V MV </div></div><!-- fragment --><h3>Loading Persistent Settings</h3>
<p>The <code>---</code> (O) command loads settings from EEPROM. Saved settings are not automatically restored at power on.</p>
<h3>Setting the Output Frequency (Side Tone)</h3>
<p>The <code>.--.</code> (P) command sets the output frequency or side tone. The frequency range is 55 to 1760 Hz. The default frequency is 750.</p>
<h3>Saving Settings</h3>
<p>The <code>...</code> (S) command saves settings to EEPROM. Settings are retained when there is no power. Settings are not automatically loaded when power is restored, thus providing a fail-safe mechanism for recovering from mis-configuration.</p>
<h3>Setting the Time</h3>
<p>The <code>-</code> (T) command expects the 24-hour time to have been entered as four digits HHMM (leading zeros may be omitted) and sets the time accordingly. The seconds are implicitly set to zero. Until the time is set, the uptime stored in EEPROM is not updated.</p>
<h3><a class="el" href="classStack.html" title="Fixed-sized stack for plain old data. ">Stack</a> Manipulation Commands</h3>
<p>The <code>-.-.</code> (C) command clears the stack.</p>
<p>The <code>......</code> (<span class="prosign">SS</span>) command pops the stack (erases the last element).</p>
<p>The <code>-..-</code> (X) command exchanges the top two entries of the stack. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 23 2018 13:42:19 for Didah Morse Code PDA/Appliance by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
